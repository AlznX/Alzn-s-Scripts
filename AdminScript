-- Sword Simulator Admin Script 2024 --

-- Add sound here
local s1 = Instance.new("Sound", workspace)
s1.Volume = 3
s1.SoundId = "rbxassetid://195868961"
s1.Looped = false
s1:Play()

local prefix, Owner, au = ";", game.Players.LocalPlayer, false
local FRIEND1_ID = 1212018424
local FRIEND2_ID = 0000
local isAdmin = { [Owner.UserId] = true, [FRIEND1_ID] = true, [FRIEND2_ID] = true }

game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "Sword Simulator Admin Script",
    Text = "Enjoy the script while it's available!"
})

local function GetPlayer(name)
    local players = {}
    for _, player in ipairs(game.Players:GetPlayers()) do
        if player.Name:lower():sub(1, #name) == name:lower() or player.DisplayName:lower():sub(1, #name) == name:lower() then
            table.insert(players, player)
        end
    end
    return players
end

local function Kill(targets)
    local sword = game.Players.LocalPlayer.Backpack:FindFirstChild("sword")
    if not sword then
        warn("[Error] Sword not found.")
        return
    end

    local damageRemoteEvent = sword:FindFirstChild("Handle")
        and sword.Handle:FindFirstChild("dmg")
        and sword.Handle.dmg:FindFirstChild("RemoteEvent")
    
    if not damageRemoteEvent then
        warn("[Error] Damage RemoteEvent not found.")
        return
    end

    for _, target in ipairs(targets) do
        if target and target.Character and target.Character:FindFirstChild("Humanoid") then
            local health = target.Character.Humanoid.Health
            if health == math.huge or health ~= health or health == -math.huge then  -- Check for infinity or NaN
            else
                pcall(function()
                    damageRemoteEvent:FireServer(target.Character.Humanoid, math.huge)
                end)
            end
        end
    end
end

local function TrackAndKill(targets)
    while #targets > 0 do
        for i = #targets, 1, -1 do
            local target = targets[i]
            if target.Character and target.Character:FindFirstChild("Humanoid") and target.Character.Humanoid.Health > 0 then
                Kill({target})
            else
                table.remove(targets, i)
            end
        end
        task.wait(0)
    end
end

local function AF()
    au = true
    local Player = game.Players.LocalPlayer
    local sword = Player.Backpack:FindFirstChild("sword")

    if not sword then
        game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest:FireServer("[System] No sword found for auto-farming.", "All")
        au = false
        return
    end

    while au do
        local upEvent = sword:FindFirstChild("Handle")
            and sword.Handle:FindFirstChild("up")
            and sword.Handle.up:FindFirstChild("RemoteEvent")
        
        if upEvent then
            pcall(function()
                upEvent:FireServer()
            end)
        end
        task.wait(0)
    end
end

local function Godmode(targets)
    local localPlayer = game.Players.LocalPlayer
    local backpack = localPlayer.Backpack
    local sword = backpack:FindFirstChild("sword")
    
    if not sword then
        repeat task.wait() until backpack:FindFirstChild("sword")
        localPlayer.Character.Humanoid:EquipTool(backpack.sword)
        sword = backpack:FindFirstChild("sword")
    end

    for _, target in ipairs(targets) do
        if target and target.Character and target.Character:FindFirstChild("Humanoid") then
            pcall(function()
                sword.Handle.dmg.RemoteEvent:FireServer(target.Character.Humanoid, -math.huge)
            end)
        end
    end
end

local function HandleCommand(message, player)
    if not message:sub(1, #prefix) == prefix then return end
    local msg = message:sub(#prefix + 1)

    if msg == "cmds" and (isAdmin[player.UserId] or player.UserId == Owner.UserId) then
        if not _G.CMD_SENT then
            _G.CMD_SENT = true
            local cmds = "[System] Commands: kill(me/plr/others/all), admin(all/plr), unadmin(all/plr), af, saf, god(me/plr/others/all), cmds"
            game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest:FireServer(cmds, "All")
        end
    elseif msg:sub(1, 5) == "kill " and isAdmin[player.UserId] then
        local target = msg:sub(6)
        if target == "all" then
            TrackAndKill(game.Players:GetPlayers())
        elseif target == "me" then
            Kill({player})
        elseif target == "others" then
            local others = {}
            for _, p in ipairs(game.Players:GetPlayers()) do
                if p.UserId ~= player.UserId then table.insert(others, p) end
            end
            TrackAndKill(others)
        else
            Kill(GetPlayer(target))
        end
    elseif msg:sub(1, 6) == "admin " and isAdmin[player.UserId] then
        local target = msg:sub(7)
        if target == "all" then
            for _, p in ipairs(game.Players:GetPlayers()) do
                if p.UserId ~= Owner.UserId and not isAdmin[p.UserId] then
                    isAdmin[p.UserId] = true
                end
            end
            game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest:FireServer("[System] Everyone is now Admin.", "All")
        else
            for _, p in ipairs(GetPlayer(target)) do
                if p.UserId ~= Owner.UserId and not isAdmin[p.UserId] then
                    isAdmin[p.UserId] = true
                    game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest:FireServer("[System] "..p.Name.." is now Admin.", "All")
                end
            end
        end
    elseif msg:sub(1, 8) == "unadmin " and isAdmin[player.UserId] then
        local target = msg:sub(9)
        if target == "all" then
            for _, p in ipairs(game.Players:GetPlayers()) do
                if p.UserId ~= Owner.UserId and isAdmin[p.UserId] then
                    isAdmin[p.UserId] = false
                end
            end
            game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest:FireServer("[System] Everybody is no longer Admin.", "All")
        else
            for _, p in ipairs(GetPlayer(target)) do
                if p.UserId ~= Owner.UserId and isAdmin[p.UserId] then
                    isAdmin[p.UserId] = false
                    game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest:FireServer("[System] "..p.Name.." is no longer Admin.", "All")
                end
            end
        end
    elseif msg:sub(1, 4) == "god " and isAdmin[player.UserId] then
        local target = msg:sub(5)
        local players = {}
        
        if target == "all" then
            for _, p in ipairs(game.Players:GetPlayers()) do
                if p.UserId ~= Owner.UserId then
                    table.insert(players, p)
                end
            end
        elseif target == "others" then
            for _, p in ipairs(game.Players:GetPlayers()) do
                if p.UserId ~= player.UserId and p.UserId ~= Owner.UserId then
                    table.insert(players, p)
                end
            end
        elseif target == "me" or target == "" then  -- Check for "me" or empty string
            table.insert(players, player)
        else
            players = GetPlayer(target)
        end
        
        for _, p in ipairs(players) do
            Godmode({p})
            task.wait(1)
            print(p.Name.." now has Godmode.")  -- Ensure this prints once without duplicating
        end
    elseif msg == "af" and player.UserId == Owner.UserId then
        AF()
    elseif msg == "saf" and player.UserId == Owner.UserId then
        au = false
    end
end

local handledPlayers = {}

local function SetupPlayer(player)
    if not handledPlayers[player] then
        handledPlayers[player] = true
        player.Chatted:Connect(function(message) HandleCommand(message, player) end)
    end
end

game.Players.PlayerAdded:Connect(SetupPlayer)
for _, player in ipairs(game.Players:GetPlayers()) do
    SetupPlayer(player)
end

game.Players.PlayerRemoving:Connect(function(player)
    handledPlayers[player] = nil
end)
