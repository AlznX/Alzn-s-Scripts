local prefix = ";"
local isAdmin = {[game.Players.LocalPlayer.Name] = true, ["FRIEND1"] = true, ["FRIEND2"] = true}
local farming = false
local Owner = game.Players.LocalPlayer

game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "Sword Simulator Admin Script",
    Text = "Enjoy the script while it's available!"
})

-- Helper function to get players by username or display name
local function GetPlayer(name)
    local players = {}
    for _, player in ipairs(game.Players:GetPlayers()) do
        if player.Name:lower():sub(1, #name) == name:lower() or player.DisplayName:lower():sub(1, #name) == name:lower() then
            table.insert(players, player)
        end
    end
    return players
end

-- Function to kill target players
local function Kill(targets)
    local sword = game.Players.LocalPlayer.Backpack:FindFirstChild("sword") or 
                  game.Players.LocalPlayer.Character:FindFirstChild("sword")

    if sword then
        local damageEvent = sword.Handle:FindFirstChild("dmg") and sword.Handle.dmg:FindFirstChild("RemoteEvent")
        if damageEvent then
            for _, target in ipairs(targets) do
                if target and target.Character and target.Character:FindFirstChild("Humanoid") then
                    pcall(function()
                        damageEvent:FireServer(target.Character.Humanoid, math.huge)
                    end)
                end
            end
        else
            warn("Damage RemoteEvent not found in sword.")
        end
    else
        warn("Sword not found in backpack or character.")
    end
end

-- Optimized Auto-Farm Function
local function farmAction()
    local sword = game.Players.LocalPlayer.Backpack:FindFirstChild("sword") or 
                  game.Players.LocalPlayer.Character:FindFirstChild("sword")

    if sword and sword.Handle:FindFirstChild("up") then
        pcall(function()
            sword.Handle.up.RemoteEvent:FireServer()
        end)
    else
        warn("Sword or upgrade RemoteEvent not found.")
    end
end

-- Start Auto-Farm
local function StartAutoFarm()
    farming = true
    while farming do
        farmAction()
        task.wait(0) -- Reduce delay for faster farming
    end
end

-- Stop Auto-Farm
local function StopAutoFarm()
    farming = false
end

-- Chat Command Handler
local function onChatted(message, player)
    if not message:lower():sub(1, #prefix) == prefix then return end
    local msg = message:sub(#prefix + 1)

    if msg == "cmds" then
        local cmds = "[System] CMDS: [1]kill(me/plr/others/all), [2]admin(all/plr), [3]unadmin(all/plr), [4]af(autofarm), [5]saf(stop autofarm), [6]cmds"
        if player == game.Players.LocalPlayer then
            game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest:FireServer(cmds, "All")
        end
    elseif msg:sub(1, 5) == "kill " and isAdmin[player.Name] then
        local target = msg:sub(6)

        if target == "all" then
            Kill(game.Players:GetPlayers())
        elseif target == "me" then
            Kill({player})
        elseif target == "others" then
            local others = {}
            for _, v in ipairs(game.Players:GetPlayers()) do
                if v.Name ~= player.Name then
                    table.insert(others, v)
                end
            end
            Kill(others)
        else
            Kill(GetPlayer(target))
        end
    elseif msg:sub(1, 6) == "admin " and isAdmin[player.Name] then
        local target = msg:sub(7)

        if target == "all" then
            for _, player in ipairs(game.Players:GetPlayers()) do
                if player.Name ~= Owner.Name then
                    isAdmin[player.Name] = true
                end
            end
        else
            local targets = GetPlayer(target)
            for _, adminTarget in ipairs(targets) do
                if adminTarget.Name ~= Owner.Name then
                    isAdmin[adminTarget.Name] = true
                end
            end
        end
    elseif msg:sub(1, 8) == "unadmin " and isAdmin[player.Name] then
        local target = msg:sub(9)

        if target == "all" then
            for _, player in ipairs(game.Players:GetPlayers()) do
                if player.Name ~= Owner.Name then
                    isAdmin[player.Name] = false
                end
            end
        else
            local targets = GetPlayer(target)
            for _, unadminTarget in ipairs(targets) do
                if unadminTarget.Name ~= Owner.Name then
                    isAdmin[unadminTarget.Name] = false
                end
            end
        end
    elseif msg == "af" and player.Name == Owner.Name then
        StartAutoFarm()
    elseif msg == "saf" and player.Name == Owner.Name then
        StopAutoFarm()
    end
end

-- Connect Chat Events
game.Players.PlayerAdded:Connect(function(player)
    player.Chatted:Connect(function(message) onChatted(message, player) end)
end)

for _, player in ipairs(game.Players:GetPlayers()) do
    player.Chatted:Connect(function(message) onChatted(message, player) end)
end
